<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Similarity Checker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #EF4A25;
            --primary-light: #ff6b47;
            --primary-rgba: 239, 74, 37;
            --bg-gradient: linear-gradient(135deg, #ffdbcc 0%, #ffe4dc 100%);
            --header-gradient: linear-gradient(135deg, #EF4A25 0%, #ff6b47 100%);
            --button-gradient: linear-gradient(135deg, #EF4A25 0%, #ff6b47 100%);
            --keyword-gradient: linear-gradient(135deg, #EF4A25 0%, #ff6b47 100%);
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
            --shadow-hover: 0 20px 40px rgba(0,0,0,0.15);
            --secondary-color: #6c757d;
            --secondary-rgba: 108, 117, 125;
        }
        
        .froala-theme {
            --primary-color: #0098F7;
            --primary-light: #33aaff;
            --primary-rgba: 0, 152, 247;
            --bg-gradient: linear-gradient(135deg, #cce7ff 0%, #e6f3ff 100%);
            --header-gradient: linear-gradient(135deg, #0098F7 0%, #33aaff 100%);
            --button-gradient: linear-gradient(135deg, #0098F7 0%, #33aaff 100%);
            --keyword-gradient: linear-gradient(135deg, #0098F7 0%, #33aaff 100%);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: var(--bg-gradient);
            min-height: 100vh;
            padding: 0;
            margin: 0;
            transition: background 0.3s ease;
        }
        
        .container {
            width: 100%;
            max-width: none;
            margin: 0;
            background: white;
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
        }
        
        .header {
            background: var(--header-gradient);
            color: white;
            padding: 30px 40px;
            text-align: center;
            transition: background 0.3s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .main-content {
            padding: 0;
            width: 100%;
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 0;
            min-height: calc(100vh - 120px);
            position: relative;
            overflow: hidden;
        }
        
        .form-section {
            position: sticky;
            top: 0;
            height: calc(100vh - 120px);
            background: white;
            backdrop-filter: none;
            border-radius: 0;
            padding: 40px 30px;
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
            border: none;
            border-right: 1px solid #e1e8ed;
            overflow-y: auto;
            grid-column: 1;
            z-index: 10;
        }
        
        .results-section {
            overflow-y: auto;
            height: calc(100vh - 120px);
            padding: 40px;
            background: #f8f9fa;
            grid-column: 2;
        }
        
        .results-section::-webkit-scrollbar {
            width: 8px;
        }
        
        .results-section::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        .results-section::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }
        
        .results-section::-webkit-scrollbar-thumb:hover {
            background: var(--primary-light);
        }
        
        .form-section {
            margin-bottom: 0;
            width: 100%;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1em;
        }
        
        textarea {
            width: 100%;
            min-height: 250px;
            padding: 20px;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s ease;
            line-height: 1.6;
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(var(--primary-rgba), 0.2);
            transition: all 0.3s ease;
        }
        
        textarea::placeholder {
            color: #95a5a6;
            line-height: 1.6;
        }
        
        .source-selection {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .radio-group {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 24px;
            border: 3px solid #e1e8ed;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            position: relative;
            overflow: hidden;
        }
        
        .radio-group::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(var(--primary-rgba), 0.05), transparent);
            transition: left 0.5s ease;
        }
        
        .radio-group:hover::before {
            left: 100%;
        }
        
        .radio-group:hover {
            border-color: var(--primary-color);
            background: rgba(var(--primary-rgba), 0.08);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(var(--primary-rgba), 0.15);
        }
        
        .radio-group input[type="radio"] {
            margin: 0;
            transform: scale(1.2);
            accent-color: var(--primary-color);
        }
        
        .radio-group.selected {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, rgba(var(--primary-rgba), 0.15) 0%, rgba(var(--primary-rgba), 0.08) 100%);
            box-shadow: 0 4px 15px rgba(var(--primary-rgba), 0.2);
            transform: translateY(-1px);
        }
        
        .radio-group label {
            font-weight: 600;
            color: #2c3e50;
            cursor: pointer;
            user-select: none;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        button {
            padding: 15px 30px;
            border: 2px solid transparent;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .btn-primary {
            background: var(--button-gradient);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 4px 15px rgba(var(--primary-rgba), 0.3);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(var(--primary-rgba), 0.5);
            border-color: var(--primary-light);
        }
        
        .btn-primary:active:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(var(--primary-rgba), 0.4);
        }
        
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 8px rgba(var(--primary-rgba), 0.2);
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }
        
        .btn-primary:hover::before {
            left: 100%;
        }
        
        .loading {
            display: none;
            color: var(--primary-color);
            font-style: italic;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        
        .loading.show {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #e1e8ed;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .results {
            display: none;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .results.show {
            display: block;
        }
        
        .recommendation {
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            font-weight: 600;
            font-size: 18px;
            border-left: 5px solid;
        }
        
        .recommendation.red {
            background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
            color: #c62828;
            border-left-color: #c62828;
        }
        
        .recommendation.orange {
            background: linear-gradient(135deg, #fff3e0 0%, #fce4ec 100%);
            color: #ef6c00;
            border-left-color: #ef6c00;
        }
        
        .recommendation.yellow {
            background: linear-gradient(135deg, #fffde7 0%, #fff8e1 100%);
            color: #f57f17;
            border-left-color: #f57f17;
        }
        
        .recommendation.green {
            background: linear-gradient(135deg, #e8f5e8 0%, #f1f8e9 100%);
            color: #2e7d32;
            border-left-color: #2e7d32;
        }
        
        .recommendation-details {
            font-size: 14px;
            font-weight: 400;
            margin-top: 10px;
            opacity: 0.8;
        }
        
        .keywords-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 30px;
            width: 100%;
            padding: 0;
        }

        .form-section .keywords-section {
            margin-top: 25px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e1e8ed;
        }
        
        .keywords-box {
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            border: 1px solid #e1e8ed;
            width: 100%;
        }

        .form-section .keywords-box {
            background: white;
            padding: 18px;
            border-radius: 10px;
        }
        
        .keywords-box h3 {
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .keyword {
            display: inline-block;
            background: var(--keyword-gradient);
            color: white;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            transition: background 0.3s ease;
        }
        
        .keyword-count {
            opacity: 0.8;
            font-size: 11px;
        }
        
        .similar-article-title {
            font-size: 13px;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 500;
            padding: 8px 12px;
            background: rgba(var(--primary-rgba), 0.1);
            border-radius: 8px;
            border-left: 3px solid var(--primary-color);
        }
        
        
        
        .section-matches {
            margin-top: 25px;
            width: 100%;
        }
        
        .section-matches h4 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.2em;
        }
        
        .section-matches-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
        }
        
        .section-match-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s ease;
            width: 100%;
            margin-bottom: 25px;
        }
        
        .section-match-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .section-match-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px 20px;
            border-bottom: 2px solid #e9ecef;
            width: 100%;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 8px 8px 0 0;
        }
        
        .section-match-header h5 {
            color: var(--primary-color);
            margin: 0;
            font-size: 1.2em;
            font-weight: 700;
        }
        
        .section-similarity-score {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 13px;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }
        
        .section-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 20px;
            width: 100%;
        }
        
        .section-column {
            background: white;
            padding: 25px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            width: 100%;
            min-width: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .section-column h5 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.1em;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 12px;
            font-weight: 700;
        }
        
        .section-text {
            font-family: 'Georgia', serif;
            font-size: 1.05em;
            line-height: 1.8;
            color: #2c3e50;
            max-height: none;
            overflow-y: visible;
            white-space: pre-wrap;
            word-wrap: break-word;
            width: 100%;
            min-width: 0;
            background: #fafbfc;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }
        
        .similarity-explanation {
            background: linear-gradient(135deg, #e8f4fd 0%, #f0f8ff 100%);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
            margin-top: 15px;
        }
        
        .similarity-explanation h6 {
            color: var(--primary-color);
            margin-bottom: 8px;
            font-size: 0.9em;
            text-transform: uppercase;
            font-weight: 600;
        }
        
        .similarity-explanation p {
            color: #2c3e50;
            font-size: 0.9em;
            line-height: 1.5;
            margin: 0;
        }
        
        .common-words-summary {
            margin-top: 15px;
            padding: 15px;
            background: rgba(var(--primary-rgba), 0.08);
            border-radius: 8px;
            border: 1px solid rgba(var(--primary-rgba), 0.2);
        }
        
        .common-words-summary strong {
            color: var(--primary-color);
            display: block;
            margin-bottom: 10px;
            font-size: 0.9em;
        }
        
        .common-word-tag {
            background: var(--primary-color);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 500;
            margin: 2px;
            display: inline-block;
        }
        
        .highlighted-word {
            background: linear-gradient(135deg, #ffeb3b 0%, #ffc107 100%);
            color: #2c3e50;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 600;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .matches-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .match-item {
            background: rgba(var(--primary-rgba), 0.1);
            color: var(--primary-color);
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            border: 1px solid rgba(var(--primary-rgba), 0.3);
        }
        
        .phrase-match {
            background: rgba(var(--secondary-rgba), 0.1);
            color: var(--secondary-color);
            border-color: rgba(var(--secondary-rgba), 0.3);
        }
        
        .similar-blogs {
            margin-top: 40px;
        }
        
        .similar-blogs h3 {
            margin-bottom: 25px;
            color: #2c3e50;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .blog-item {
            background: #ffffff;
            padding: 25px;
            margin-bottom: 30px;
            border-radius: 15px;
            border: 2px solid #e1e8ed;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .blog-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .blog-header {
            margin-bottom: 20px;
        }

        .blog-title-row {
            margin-bottom: 15px;
        }

        .blog-meta-bar {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            border: 1px solid #e1e8ed;
            width: 100%;
        }

        .blog-meta-left {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 12px;
            flex: 1;
        }

        .blog-meta-right {
            display: none; /* No longer used - all buttons moved to left */
        }
        
        .blog-title-section {
            margin-bottom: 15px;
        }

        .blog-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .blog-link {
            margin-top: 5px;
        }

        .blog-url-link {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 0.9em;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .blog-url-link:hover {
            color: var(--primary-light);
            text-decoration: underline;
        }

        .meta-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 8px;
        }

        .meta-label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9em;
            min-width: 100px;
            flex-shrink: 0;
        }

        .action-buttons {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .blog-description-section {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            border: 1px solid #e1e8ed;
        }

        .section-label {
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 1em;
            font-weight: 600;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 5px;
        }
        
        .blog-title a {
            text-decoration: none;
            color: inherit;
            transition: color 0.3s ease;
        }
        
        .blog-title a:hover {
            color: var(--primary-color);
            transition: color 0.3s ease;
        }
        
        .similarity-score {
            display: flex;
            align-items: center;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .similarity-high {
            background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
            color: #c62828;
        }
        
        .similarity-medium {
            background: linear-gradient(135deg, #fff3e0 0%, #fce4ec 100%);
            color: #ef6c00;
        }
        
        .similarity-low {
            background: linear-gradient(135deg, #e8f5e8 0%, #f1f8e9 100%);
            color: #2e7d32;
        }
        
        .blog-description {
            color: #7f8c8d;
            margin-bottom: 15px;
            font-size: 15px;
            line-height: 1.5;
        }
        
        .blog-keywords {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .blog-keywords .keyword {
            background: linear-gradient(135deg, #d2b48c 0%, #daa520 100%);
            color: white;
            font-size: 12px;
            padding: 6px 12px;
        }
        
        .error {
            background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
            color: #c62828;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border: 1px solid #ffcdd2;
            display: none;
        }
        
        .error.show {
            display: block;
        }
        
        .word-count {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 10px;
        }
        
        .gpt-analysis-detail {
            background: #f0f7f7;
            border-radius: 10px;
            margin-top: 20px;
            border: 1px solid #d0e9e9;
            overflow: hidden;
        }
        
        .analysis-header {
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 1px solid #d0e9e9;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 8px 8px 0 0;
            position: relative;
        }
        
        .analysis-header:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        


        .analysis-header h4 {
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 1.1em;
            padding-right: 40px;
        }
        
        .toggle-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            font-size: 14px;
            color: var(--primary-color);
            font-weight: 600;
            padding: 8px 12px;
            background: rgba(var(--primary-rgba), 0.1);
            border-radius: 6px;
            border: 1px solid rgba(var(--primary-rgba), 0.2);
            cursor: pointer;
            user-select: none;
        }
        
        .expand-icon {
            transition: transform 0.3s ease;
            font-size: 14px;
            font-weight: bold;
        }
        
        .analysis-header.expanded .expand-icon {
            transform: rotate(180deg);
        }
        
        .analysis-header.expanded .expand-text::after {
            content: " (click to collapse)";
        }
        
        .gpt-analysis-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            margin-top: 15px;
            background: #ffffff;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .gpt-analysis-content.expanded {
            max-height: none;
            padding: 20px;
            border-top: 3px solid var(--primary-color);
        }

        .gpt-analysis-content.collapsed {
            max-height: 0;
            padding: 0;
        }

        .gpt-analysis-text {
            font-size: 14px;
            line-height: 1.6;
            color: #333;
        }
        
        .gpt-analysis-text h2, .gpt-analysis-text h3, .gpt-analysis-text h4 {
            color: #2c3e50;
            margin: 20px 0 10px 0;
            font-weight: 600;
        }
        
        .gpt-analysis-text h4 {
            font-size: 16px;
            color: var(--primary-color);
        }
        
        .gpt-analysis-text h3 {
            font-size: 18px;
        }
        
        .gpt-analysis-text h2 {
            font-size: 20px;
        }
        
        .gpt-analysis-text ul, .gpt-analysis-text ol {
            margin: 15px 0;
            padding-left: 25px;
        }
        
        .gpt-analysis-text ol {
            list-style-type: decimal;
        }
        
        .gpt-analysis-text ul {
            list-style-type: disc;
        }
        
        .gpt-analysis-text li {
            margin: 8px 0;
            line-height: 1.5;
        }
        
        .gpt-analysis-text p {
            margin: 10px 0;
        }
        
        .gpt-analysis-text strong {
            color: #2c3e50;
        }
        
        .gpt-analysis-text code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 13px;
        }
        
        .gpt-analysis-text pre {
            background: #f8f8f8;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .gpt-analysis-text pre code {
            background: none;
            padding: 0;
        }
        
        .analysis-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            border: 1px solid #d0e9e9;
        }
        
        .similarity-badge {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 0.85em;
        }
        
        .length-info {
            color: #555;
            font-size: 0.85em;
            font-weight: 500;
        }
        
        .similarity-metrics {
            margin-top: 20px;
            border-top: 1px dashed #e0e0e0;
            padding-top: 20px;
        }
        
                 /* Integrated Section Comparison Styles */
                 .section-comparison-toggle {
            margin-top: 20px;
            padding: 15px 20px;
            background: rgba(var(--primary-rgba), 0.1);
            border-radius: 8px;
            border: 1px solid rgba(var(--primary-rgba), 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .section-comparison-toggle:hover {
            background: rgba(var(--primary-rgba), 0.15);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(var(--primary-rgba), 0.1);
        }

        .section-comparison-toggle-text {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-comparison-arrow {
            transition: transform 0.3s ease;
            font-size: 14px;
            font-weight: bold;
        }

        .section-comparison-toggle.expanded .section-comparison-arrow {
            transform: rotate(180deg);
        }
        
        .section-comparison-bar {
            margin-top: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            border: 1px solid #e1e8ed;
        }

        .section-comparison-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
            margin-top: 15px;
        }

        .section-comparison-content.expanded {
            max-height: none;
            padding: 20px;
            background: #ffffff;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            border-top: 3px solid var(--primary-color);
        }
        
        .section-comparison-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        
        .section-comparison-metrics .metric-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .section-comparison-metrics .metric-label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9em;
        }
        
        .section-comparison-metrics .metric-value {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1em;
        }

        .cosine-similarity {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e9ecef;
            text-align: center;
        }

        .cosine-similarity h4 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 1.1em;
        }

        .similarity-score-large {
            font-size: 24px;
            font-weight: 700;
            padding: 15px 25px;
            border-radius: 25px;
            margin: 10px 0;
            display: inline-block;
            min-width: 200px;
        }

        .similarity-explanation {
            font-size: 13px;
            color: #7f8c8d;
            font-style: italic;
            margin-top: 10px;
        }
        
        .step-time {
            font-size: 12px;
            color: #7f8c8d;
            margin-left: 10px;
        }
        
        .progress-steps {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background: #f0f7f7;
            border-radius: 10px;
            border: 1px solid #d0e9e9;
        }
        
        .progress-steps.show {
            display: block;
        }
        
        .progress-step {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .step-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        
        .step-icon.pending {
            background-color: #e0e0e0;
            color: #555;
        }
        
        .step-icon.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .step-icon.completed {
            background-color: #4CAF50;
            color: white;
        }
        
        .step-text {
            font-size: 14px;
            color: #333;
        }
        
        .step-text.active {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .step-text.completed {
            color: #2e7d32;
        }
        
        @media (max-width: 768px) {
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .main-content {
                padding: 0;
                grid-template-columns: 1fr;
                gap: 0;
            }
            
            .form-section {
                position: static;
                height: auto;
                border-right: none;
                border-bottom: 1px solid #e1e8ed;
                box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
                grid-column: 1;
            }
            
            .results-section {
                height: auto;
                overflow-y: visible;
                padding: 20px;
                grid-column: 1;
            }
            
            .keywords-section {
                grid-template-columns: 1fr;
            }

            .form-section .keywords-section {
                padding: 15px;
                margin-top: 20px;
            }

            .form-section .keywords-box {
                padding: 15px;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: stretch;
            }
            
            button {
                justify-content: center;
            }
            
            .source-selection {
                flex-direction: column;
                align-items: stretch;
            }
            
            .blog-title-section {
                margin-bottom: 12px;
            }

            .blog-meta-bar {
                padding: 12px;
            }

            .meta-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }

            .meta-label {
                min-width: auto;
                margin-bottom: 4px;
            }

            .blog-description-section {
                padding: 12px;
                margin-top: 12px;
            }

            .section-label {
                font-size: 0.95em;
            }

            .blog-meta-left {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
                width: 100%;
            }

            .similarity-score {
                align-self: flex-start;
                font-size: 13px;
                padding: 6px 12px;
            }

            .length-info {
                font-size: 0.8em;
                line-height: 1.3;
            }

            .toggle-btn {
                width: 100%;
                justify-content: flex-start;
                padding: 10px 15px;
                margin-top: 8px;
            }

            .section-comparison-bar {
                padding: 12px;
            }

            .section-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📝 Blog Similarity Checker</h1>
            <p>Check if your draft content is too similar to existing blog posts using AI-powered semantic analysis</p>
        </div>
        
        <div class="main-content">
            <div class="form-section">
                <div class="form-group">
                    <label for="draftText">📄 Paste your draft blog content:</label>
                    <textarea 
                        id="draftText" 
                        placeholder="Paste your blog draft here...

Example:
'How to build a modern rich text editor for web applications. Rich text editors are essential components that allow users to format text with bold, italic, links, and other styling options. In this guide, we'll explore the key considerations when building or choosing a rich text editor...'

Minimum 50 characters required for analysis."
                        oninput="updateWordCount()"
                    ></textarea>
                    <div id="wordCount" class="word-count">0 characters</div>
                </div>
                
                <div class="form-group">
                    <label>🎯 Check against which blog source:</label>
                    <div class="source-selection">
                        <div class="radio-group selected" onclick="selectSource('filestack')">
                            <input type="radio" id="filestack" name="source" value="filestack" checked>
                            <label for="filestack">📚 Filestack Blogs</label>
                        </div>
                        <div class="radio-group" onclick="selectSource('froala')">
                            <input type="radio" id="froala" name="source" value="froala">
                            <label for="froala">✨ Froala Blogs</label>
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button id="checkSimilarity" class="btn-primary" onclick="checkSimilarity()">
                        🔍 Check Similarity
                    </button>
                                         <div id="loading" class="loading">
                         <div class="spinner"></div>
                         <span>Analyzing similarity with AI...</span>
                     </div>
                     
                     <div id="progressSteps" class="progress-steps">
                         <div class="progress-step" id="step1">
                             <div class="step-icon pending">1</div>
                             <div class="step-text">Generating embeddings for your draft</div>
                             <div class="step-time"></div>
                         </div>
                         <div class="progress-step" id="step2">
                             <div class="step-icon pending">2</div>
                             <div class="step-text">Searching vector database for similar content</div>
                             <div class="step-time"></div>
                         </div>
                         <div class="progress-step" id="step3">
                             <div class="step-icon pending">3</div>
                             <div class="step-text">Analyzing content with GPT-4o-mini</div>
                             <div class="step-time"></div>
                         </div>
                         <div class="progress-step" id="step4">
                             <div class="step-icon pending">4</div>
                             <div class="step-text">Preparing results</div>
                             <div class="step-time"></div>
                         </div>
                     </div>
                 </div>

                 <div id="draftKeywordsSection" class="keywords-section" style="display: none;">
                     <div class="keywords-box">
                         <h3>🎯 Your Draft Keywords</h3>
                         <div id="draftKeywords"></div>
                     </div>
                     <div class="keywords-box">
                         <h3>📚 Top Similar Article Keywords</h3>
                         <div style="font-size: 12px; color: #666; margin-bottom: 15px; font-style: italic;">
                             Keywords from the most similar article only (not aggregated from all results)
                         </div>
                         <div id="similarArticleTitle" class="similar-article-title"></div>
                         <div id="similarKeywords"></div>
                     </div>
                 </div>

                 <div id="error" class="error"></div>
            </div>
            
            <div class="results-section">
                <div id="results" class="results">
                <div id="recommendation" class="recommendation"></div>

                <div class="similar-blogs">
                    <h3>🔍 Most Similar Blog Posts</h3>
                    <div id="blogsList"></div>
                </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let isChecking = false;
        
        // Update word count
        function updateWordCount() {
            const text = document.getElementById('draftText').value;
            const count = text.length;
            document.getElementById('wordCount').textContent = `${count} characters`;
        }
        
        // Handle source selection
        function selectSource(source) {
            // Update radio buttons
            document.getElementById('filestack').checked = (source === 'filestack');
            document.getElementById('froala').checked = (source === 'froala');
            
            // Update visual selection
            document.querySelectorAll('.radio-group').forEach(group => {
                group.classList.remove('selected');
            });
            event.target.closest('.radio-group').classList.add('selected');
            
            // Update theme based on source
            updateTheme(source);
        }
        
        // Update theme colors based on selected source
        function updateTheme(source) {
            const body = document.body;
            if (source === 'froala') {
                body.classList.add('froala-theme');
            } else {
                body.classList.remove('froala-theme');
            }
        }
        
        // Show error message
        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
        }
        
        // Hide error message
        function hideError() {
            document.getElementById('error').classList.remove('show');
        }
        
        // Enhanced markdown renderer for GPT analysis - optimized for less whitespace
        function renderMarkdown(text) {
            if (!text) return '';
            
            // Cache the result to avoid reprocessing
            const cacheKey = `markdown_${text.length}_${text.substring(0, 100)}`;
            if (renderMarkdown.cache && renderMarkdown.cache[cacheKey]) {
                return renderMarkdown.cache[cacheKey];
            }
            
            // Initialize cache if not exists
            if (!renderMarkdown.cache) renderMarkdown.cache = {};
            
            let result = text
                .trim() // Remove leading/trailing whitespace
                .replace(/\n{3,}/g, '\n\n') // Reduce multiple line breaks to max 2
                .replace(/^\s+/gm, ''); // Remove leading whitespace from each line
            
            // Process headers first (with proper escaping)
            result = result
                .replace(/^#### (.*$)/gm, '<h4>$1</h4>')
                .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                .replace(/^# (.*$)/gm, '<h1>$1</h1>');
            
            // Process numbered lists (1. 2. 3. etc)
            result = result.replace(/^\d+\.\s+(.+)$/gm, '<li class="numbered-item">$1</li>');
            
            // Process bullet points (- * + at start of line)
            result = result.replace(/^[-*+]\s+(.+)$/gm, '<li class="bullet-item">$1</li>');
            
            // Wrap consecutive list items in proper list containers
            result = result.replace(/(<li class="numbered-item">.*?<\/li>(?:\s*<li class="numbered-item">.*?<\/li>)*)/gs, '<ol>$1</ol>');
            result = result.replace(/(<li class="bullet-item">.*?<\/li>(?:\s*<li class="bullet-item">.*?<\/li>)*)/gs, '<ul>$1</ul>');
            
            // Clean up list classes after wrapping
            result = result.replace(/class="numbered-item"/g, '').replace(/class="bullet-item"/g, '');
            
            // Process bold and italic text
            result = result
                .replace(/\*\*((?:(?!\*\*).)*)\*\*/g, '<strong>$1</strong>')
                .replace(/(?<!\*)\*([^*\n]+)\*(?!\*)/g, '<em>$1</em>');
            
            // Process code blocks and inline code
            result = result.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>');
            result = result.replace(/`([^`\n]+)`/g, '<code>$1</code>');
            
            // Split into paragraphs based on double line breaks, but be more conservative
            const paragraphs = result.split(/\n\n+/).filter(p => p.trim());
            
            // Process each paragraph
            result = paragraphs.map(paragraph => {
                paragraph = paragraph.trim().replace(/\n/g, ' '); // Single line breaks become spaces
                
                // Don't wrap headers, lists, or code blocks in paragraphs
                if (paragraph.match(/^<[h1-6]|^<[uo]l|^<pre>/)) {
                    return paragraph;
                }
                
                // Wrap other content in paragraphs
                return paragraph ? `<p>${paragraph}</p>` : '';
            }).filter(p => p).join('');
            
            // Clean up any remaining issues
            result = result
                .replace(/<p><\/p>/g, '') // Remove empty paragraphs
                .replace(/<p>(<[h1-6])/g, '$1') // Headers shouldn't be in paragraphs
                .replace(/(<\/[h1-6]>)<\/p>/g, '$1')
                .replace(/<p>(<[uo]l)/g, '$1') // Lists shouldn't be in paragraphs
                .replace(/(<\/[uo]l>)<\/p>/g, '$1')
                .replace(/<p>(<pre>)/g, '$1') // Code blocks shouldn't be in paragraphs
                .replace(/(<\/pre>)<\/p>/g, '$1');
            
            // Cache the result
            renderMarkdown.cache[cacheKey] = result;
            
            // Limit cache size
            const cacheKeys = Object.keys(renderMarkdown.cache);
            if (cacheKeys.length > 50) {
                delete renderMarkdown.cache[cacheKeys[0]];
            }
            
            return result;
        }
        
        // Show loading state
        function showLoading() {
            document.getElementById('loading').classList.add('show');
            document.getElementById('checkSimilarity').disabled = true;
            document.getElementById('results').classList.remove('show');
            document.getElementById('draftKeywordsSection').style.display = 'none';
            isChecking = true;
        }
        
                 // Hide loading state
         function hideLoading() {
             document.getElementById('loading').classList.remove('show');
             document.getElementById('checkSimilarity').disabled = false;
             isChecking = false;
         }
         
         // Progress tracking functions
         function showProgressSteps() {
             document.getElementById('progressSteps').classList.add('show');
         }
         
         function hideProgressSteps() {
             document.getElementById('progressSteps').classList.remove('show');
         }
         
         function updateProgressStep(stepNumber, status, time = '') {
             const step = document.getElementById(`step${stepNumber}`);
             if (!step) return;
             
             const icon = step.querySelector('.step-icon');
             const text = step.querySelector('.step-text');
             const timeEl = step.querySelector('.step-time');
             
             // Remove all status classes
             icon.classList.remove('pending', 'active', 'completed');
             text.classList.remove('active', 'completed');
             
             // Add new status class
             icon.classList.add(status);
             if (status === 'active' || status === 'completed') {
                 text.classList.add(status);
             }
             
             // Update time if provided
             if (time) {
                 timeEl.textContent = time;
             }
         }
         
         function startProgressTracking() {
             showProgressSteps();
             
             // Step 1: Generating embeddings
             updateProgressStep(1, 'active');
             
             // Simulate progress updates (these will be replaced by real progress from Apps Script)
             setTimeout(() => {
                 updateProgressStep(1, 'completed', '✓');
                 updateProgressStep(2, 'active');
             }, 2000);
             
             setTimeout(() => {
                 updateProgressStep(2, 'completed', '✓');
                 updateProgressStep(3, 'active');
             }, 4000);
             
             setTimeout(() => {
                 updateProgressStep(3, 'completed', '✓');
                 updateProgressStep(4, 'active');
             }, 6000);
         }
        
        // Display results with detailed timing
        function displayResults(data) {
            // Basic elements timing
            const basicStart = performance.now();
            
            // Display recommendation
            const recommendation = document.getElementById('recommendation');
            const rec = data.recommendations;
            
            let recommendationHTML = `<div>${rec.message}</div>`;
            if (rec.details) {
                recommendationHTML += `<div class="recommendation-details">${rec.details}</div>`;
            }
            
            recommendation.innerHTML = recommendationHTML;
            recommendation.className = `recommendation ${rec.color}`;
            
            // Show keywords section in form area
            const draftKeywordsSection = document.getElementById('draftKeywordsSection');
            draftKeywordsSection.style.display = 'block';

            // Display draft keywords
            const draftKeywords = document.getElementById('draftKeywords');
            draftKeywords.innerHTML = data.draftKeywords
                .slice(0, 10)
                .map(([word, count]) => `<span class="keyword">${word} <span class="keyword-count">(${count})</span></span>`)
                .join('');

            // Display similar articles keywords (from top article only)
            const similarKeywords = document.getElementById('similarKeywords');
            const similarArticleTitle = document.getElementById('similarArticleTitle');

            if (data.similarKeywords && data.similarKeywords.length > 0 && data.similarBlogs && data.similarBlogs.length > 0) {
                // Show which article the keywords are from
                const topArticle = data.similarBlogs[0];
                similarArticleTitle.innerHTML = `📄 <strong>"${topArticle.title}"</strong> <span style="color: var(--primary-color); font-size: 12px;">(${topArticle.similarity}% similar)</span>`;

                similarKeywords.innerHTML = data.similarKeywords
                    .slice(0, 10)
                    .map(([word, count]) => `<span class="keyword">${word} <span class="keyword-count">(${count})</span></span>`)
                    .join('');
            } else {
                similarArticleTitle.innerHTML = '';
                similarKeywords.innerHTML = '<span style="color: #666; font-style: italic;">No similar articles found</span>';
            }
            
            // Display word-by-word comparison
            if (data.wordComparison) {
                // Store word comparison data for use in blog display
                window.wordComparisonData = data.wordComparison;
            }
            
            // Blog list timing
            const blogStart = performance.now();
            const blogsList = document.getElementById('blogsList');
            const draftText = document.getElementById('draftText').value.trim();
            
            // Truncate content for better performance
            const truncateText = (text, maxLength = 1000) => {
                if (!text || text.length <= maxLength) return text || 'Content not available';
                return text.substring(0, maxLength) + '... <em>(content truncated for performance)</em>';
            };
            
            const truncatedDraft = truncateText(draftText);
            
            // Build HTML with timing for each blog
            const htmlParts = [];
            data.similarBlogs.forEach((blog, index) => {
                const blogItemStart = performance.now();
                
                const similarity = parseFloat(blog.similarity);
                const similarityClass = similarity >= 70 ? 'similarity-high' : 
                                      similarity >= 50 ? 'similarity-medium' : 'similarity-low';
                
                const keywords = blog.keywords || [];
                const isTopThree = index < 3; // Only first 3 blogs get GPT analysis
                const gptAnalysis = data.gptAnalyses && data.gptAnalyses[index] ? data.gptAnalyses[index] : null;
                const truncatedBlogContent = truncateText(blog.content);
                
                // Store rendered analysis for top 3 blogs
                let renderedAnalysis = '';
                if (isTopThree && gptAnalysis) {
                    renderedAnalysis = renderMarkdown(gptAnalysis.analysis);
                }
                
                htmlParts.push(`
                    <div class="blog-item">
                        <div class="blog-header">
                            <div class="blog-title-section">
                                <div class="blog-title">
                                    <a href="${blog.url}" target="_blank">${blog.title}</a>
                                </div>
                                <div class="blog-link">
                                    <a href="${blog.url}" target="_blank" class="blog-url-link">🔗 ${blog.url}</a>
                                </div>
                            </div>

                            <div class="blog-meta-bar">
                                <div class="blog-meta-left">
                                    <div class="meta-item">
                                        <span class="meta-label">Similarity:</span>
                                        <div class="similarity-score ${similarityClass}">${blog.similarity}% cosine similarity</div>
                                    </div>
                                    ${isTopThree && gptAnalysis ? `<div class="meta-item">
                                        <span class="meta-label">Content Length:</span>
                                        <span class="length-info">Draft: ${gptAnalysis.draftLength.toLocaleString()} chars | Blog: ${gptAnalysis.contentLength.toLocaleString()} chars</span>
                                    </div>` : ''}
                                    <div class="meta-item">
                                        <span class="meta-label">Actions:</span>
                                        <div class="action-buttons">
                                            ${isTopThree ? `<div class="toggle-btn" onclick="toggleAnalysis(${index})">
                                                <span class="expand-icon">▼</span>
                                                <span class="expand-text">AI Analysis</span>
                                            </div>` : `<span class="ranking-badge">Ranked #${index + 1}</span>`}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="blog-description-section">
                            <h6 class="section-label">📄 Meta Description</h6>
                            <div class="blog-description">${blog.description || 'No meta description available'}</div>
                        </div>

                        ${isTopThree && gptAnalysis ? `<div class="gpt-analysis-content collapsed" id="analysis-${index}">
                            <div class="gpt-analysis-text">${renderedAnalysis}</div>
                        </div>` : ''}

                         ${index === 0 && window.wordComparisonData ? `
                         <div class="section-comparison-bar">
                             <div class="toggle-btn" onclick="toggleSectionComparison(${index})">
                                 <span class="expand-icon">▼</span>
                                 <span class="expand-text">🔍 Section-by-Section Comparison</span>
                             </div>
                         </div>
                         <div class="section-comparison-content collapsed" id="sectionComparison-${index}">
                             <div class="section-comparison-metrics">
                                 <div class="metric-item">
                                     <span class="metric-label">Matching Sections:</span>
                                     <span class="metric-value">${window.wordComparisonData.metrics.matchingSections}</span>
                                 </div>
                                 <div class="metric-item">
                                     <span class="metric-label">Average Section Similarity:</span>
                                     <span class="metric-value">${window.wordComparisonData.metrics.averageSectionSimilarity}%</span>
                                 </div>
                                 <div class="metric-item">
                                     <span class="metric-label">Total Draft Words:</span>
                                     <span class="metric-value">${window.wordComparisonData.metrics.totalDraftWords.toLocaleString()}</span>
                                 </div>
                                 <div class="metric-item">
                                     <span class="metric-label">Total Similar Words:</span>
                                     <span class="metric-value">${window.wordComparisonData.metrics.totalSimilarWords.toLocaleString()}</span>
                                 </div>
                             </div>
                             <div class="section-matches">
                                 <h4>📋 Similar Sections Found</h4>
                                 <div class="section-matches-list">
                                     ${generateSectionMatchesHTML(window.wordComparisonData.sectionMatches)}
                                 </div>
                             </div>
                         </div>
                         ` : ''}
                         
                         <div class="blog-keywords">
                             ${keywords.slice(0, 5).map(([word]) => `<span class="keyword">${word}</span>`).join('')}
                         </div>
                    </div>
                `);
                
            });
            
            // Single DOM update
            blogsList.innerHTML = htmlParts.join('');
            
            // Show results
            document.getElementById('results').classList.add('show');
        }
        
        // Performance timing utilities
        const performanceTimer = {
            timers: {},
            start(label) {
                this.timers[label] = performance.now();
            },
            end(label) {
                if (this.timers[label]) {
                    const elapsed = performance.now() - this.timers[label];
                    delete this.timers[label];
                    return elapsed;
                }
                return 0;
            },
            step(stepNumber, label, elapsed) {
                updateProgressStep(stepNumber, 'completed', `${elapsed.toFixed(0)}ms`);
            }
        };

        // Main similarity check function
        async function checkSimilarity() {
            const draftText = document.getElementById('draftText').value.trim();
            const source = document.querySelector('input[name="source"]:checked')?.value;
            
            if (!draftText) {
                showError('Please enter your draft content.');
                return;
            }
            
            if (!source) {
                showError('Please select a content source.');
                return;
            }
            
            if (isChecking) {
                return; // Prevent multiple simultaneous requests
            }
            
            performanceTimer.start('TOTAL_PROCESS');
            hideError();
            showLoading();
            startProgressTracking(); // Start progress tracking
            
            try {
                performanceTimer.start('APPS_SCRIPT_CALL');
                updateProgressStep(1, 'active');
                
                // Call the Apps Script function (which will handle API keys from environment)
                const results = await new Promise((resolve, reject) => {
                    google.script.run
                        .withSuccessHandler((result) => {
                            const elapsed = performanceTimer.end('APPS_SCRIPT_CALL');
                            resolve(result);
                        })
                        .withFailureHandler((error) => {
                            performanceTimer.end('APPS_SCRIPT_CALL');
                            reject(new Error(error.message || 'Apps Script execution failed'));
                        })
                        .processSimilarityCheck(draftText, source);
                });
                
                performanceTimer.start('FRONTEND_PROCESSING');
                updateProgressStep(4, 'active');
                
                if (results && results.error) {
                    showError(results.error);
                } else if (results) {
                    performanceTimer.start('DISPLAY_RESULTS');
                    displayResults(results);
                    const displayElapsed = performanceTimer.end('DISPLAY_RESULTS');
                    performanceTimer.step(4, 'Preparing results', displayElapsed);
                } else {
                    showError('No results received from similarity check');
                }
                
                const frontendElapsed = performanceTimer.end('FRONTEND_PROCESSING');
                
            } catch (error) {
                // Better error handling for common Apps Script issues
                let errorMessage = 'Something went wrong. Please try again.';
                
                if (error.message.includes('Script function not found')) {
                    errorMessage = 'Apps Script function not found. Please check your code.';
                } else if (error.message.includes('Authorization required')) {
                    errorMessage = 'Authorization required. Please refresh and try again.';
                } else if (error.message.includes('API')) {
                    errorMessage = 'API error. Please check your API keys in Apps Script environment variables.';
                } else if (error.message) {
                    errorMessage = error.message;
                }
                
                showError(`Error: ${errorMessage}`);
            } finally {
                const totalElapsed = performanceTimer.end('TOTAL_PROCESS');
                hideLoading();
                hideProgressSteps();
            }
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl+Enter to check similarity
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                checkSimilarity();
            }
        });
        
        // Initialize
        updateWordCount();
        
        // Set initial theme based on default selection
        updateTheme('filestack');
        
        // Focus on textarea when page loads
        document.getElementById('draftText').focus();
        
        // Toggle analysis sections
        function toggleAnalysis(index) {
            const analysisContent = document.getElementById(`analysis-${index}`);
            const toggleBtn = document.querySelector(`.blog-meta-left .toggle-btn[onclick*="toggleAnalysis(${index})"]`);
            const expandIcon = toggleBtn.querySelector('.expand-icon');
            const expandText = toggleBtn.querySelector('.expand-text');

            if (analysisContent.classList.contains('collapsed')) {
                analysisContent.classList.remove('collapsed');
                analysisContent.classList.add('expanded');

                // Smooth expand animation
                analysisContent.style.maxHeight = analysisContent.scrollHeight + 'px';

                // Update text and icon
                expandText.textContent = 'AI Analysis ▲';
                expandIcon.textContent = '▲';
            } else {
                analysisContent.classList.remove('expanded');
                analysisContent.classList.add('collapsed');

                // Smooth collapse animation
                analysisContent.style.maxHeight = '0px';

                // Update text and icon
                expandText.textContent = 'AI Analysis ▼';
                expandIcon.textContent = '▼';
            }
        }
        
        function toggleSimilarityView(blogIndex) {
            const blogItem = document.querySelectorAll('.blog-item')[blogIndex];
            const contentComparison = blogItem.querySelector('.content-comparison');
            const toggleBtn = blogItem.querySelector('.toggle-btn');
            
            if (contentComparison.style.display === 'none') {
                contentComparison.style.display = 'flex';
                toggleBtn.textContent = '🔍 Hide Content Comparison';
            } else {
                contentComparison.style.display = 'none';
                toggleBtn.textContent = '🔍 Show Content Comparison';
            }
        }
        
                                 // Generate HTML for section matches (used in blog display)
         function generateSectionMatchesHTML(sectionMatches) {
             if (!sectionMatches || sectionMatches.length === 0) {
                 return '<div style="color: #666; font-style: italic; text-align: center; padding: 40px;">No similar sections found between your draft and this article</div>';
             }
             
             return sectionMatches.map((match, index) => {
                 const similarityPercent = (match.similarity * 100).toFixed(1);
                 
                 // Create similarity explanation based on Jaccard similarity
                 const explanation = match.similarity >= 0.9 ? 
                     "Very high similarity - these sections share almost identical content structure and key terms." :
                     match.similarity >= 0.8 ? 
                     "High similarity - these sections share significant content overlap and similar messaging." :
                     match.similarity >= 0.7 ? 
                     "Moderate similarity - these sections share common themes and some overlapping content." :
                     "Lower similarity - these sections share some common elements but are mostly distinct.";
                 
                                                     // Highlight common words in both sections
                   const highlightCommonWords = (text, commonWords) => {
                       if (!commonWords || commonWords.length === 0) return text;

                       // Escape the text for HTML display, but preserve our highlighting markup
                       let highlightedText = text
                           .replace(/&/g, '&amp;')
                           .replace(/</g, '&lt;')
                           .replace(/>/g, '&gt;')
                           .replace(/"/g, '&quot;')
                           .replace(/'/g, '&#39;')
                           .replace(/\n/g, '<br>'); // Convert line breaks to HTML

                       // Apply highlighting by replacing word boundaries with marked versions
                       commonWords.forEach(word => {
                           if (word && word.length > 0) {
                               // Escape the word for regex and HTML
                               const escapedWord = word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                               // Create a regex that matches word boundaries
                               const wordRegex = new RegExp(`\\b${escapedWord}\\b`, 'gi');

                               // Replace with highlighted version, but we need to handle HTML entities
                               // First, temporarily replace our marker with a placeholder
                               highlightedText = highlightedText.replace(wordRegex, `###HIGHLIGHT_START###${word}###HIGHLIGHT_END###`);
                           }
                       });

                       // Now replace the placeholders with proper HTML tags
                       highlightedText = highlightedText
                           .replace(/###HIGHLIGHT_START###/g, '<mark class="highlighted-word">')
                           .replace(/###HIGHLIGHT_END###/g, '</mark>');

                       return highlightedText;
                   };
                 
                 const highlightedDraft = highlightCommonWords(match.draftSection, match.commonWords);
                 const highlightedSimilar = highlightCommonWords(match.similarSection, match.commonWords);
                 
                 return `
                     <div class="section-match-item">
                         <div class="section-match-header">
                             <h5>Section Match #${index + 1}</h5>
                             <span class="section-similarity-score">${similarityPercent}% similar</span>
                         </div>
                         <div class="section-content">
                             <div class="section-column">
                                 <h5>📝 Your Draft</h5>
                                 <div class="section-text">${highlightedDraft}</div>
                             </div>
                             <div class="section-column">
                                 <h5>📄 Similar Article</h5>
                                 <div class="section-text">${highlightedSimilar}</div>
                             </div>
                         </div>
                         <div class="similarity-explanation">
                             <h6>🔍 Why These Sections Are Similar</h6>
                             <p>${explanation}</p>
                             <div class="common-words-summary">
                                 <strong>Common Words Found:</strong> 
                                 ${match.commonWords.map(word => `<span class="highlighted-word">${word}</span>`).join(' ')}
                             </div>
                         </div>
                     </div>
                 `;
             }).join('');
         }
         
                 // Toggle section comparison visibility
        function toggleSectionComparison(blogIndex) {
            const comparisonContent = document.getElementById(`sectionComparison-${blogIndex}`);
            const toggleBtn = document.querySelector(`.section-comparison-bar .toggle-btn[onclick*="toggleSectionComparison(${blogIndex})"]`);
            const expandIcon = toggleBtn.querySelector('.expand-icon');
            const expandText = toggleBtn.querySelector('.expand-text');

            if (comparisonContent.classList.contains('expanded')) {
                // Collapse
                comparisonContent.classList.remove('expanded');
                comparisonContent.classList.add('collapsed');
                expandIcon.textContent = '▼';

                // Smooth collapse animation
                comparisonContent.style.maxHeight = '0px';

                // Update text
                expandText.textContent = '🔍 Section-by-Section Comparison ▼';
            } else {
                // Expand
                comparisonContent.classList.remove('collapsed');
                comparisonContent.classList.add('expanded');
                expandIcon.textContent = '▲';

                // Smooth expand animation
                comparisonContent.style.maxHeight = comparisonContent.scrollHeight + 'px';

                // Update text
                expandText.textContent = '🔍 Section-by-Section Comparison ▲';
            }
        }
    </script>
</body>
</html>